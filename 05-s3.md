# s3

mood music: [quiet mornings](https://www.youtube.com/watch?v=ecechHEtkYU)

[s3 overview](https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/learn/lecture/13528314#lecture-article) + [s3 hands on](https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/learn/lecture/23743312#lecture-article)
* files are stored as objects within region-specific buckets requiring globally unique names
* key = prefix and object name (although no true directories) - `s3://bucket/prefix/file.extension`
* object value = content of the body...
* file size limit: 5tb; multipart upload required for >5gb
* can tag, version, etc metadata

[s3 security](https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/learn/lecture/13528320#lecture-article) + [hands on](https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/learn/lecture/19736414#lecture-article)
* iam policy / role - json as usual
* resource based bucket policy - can cross account; object access control list, bucket access control list
* iam OR resource AND no explict deny
* encryption using keys
* note in TF you don't actually have to policy for the most common stuff: 

```
resource "aws_s3_bucket_public_access_block" "lambda_response_bucket_pab" {
  bucket = aws_s3_bucket.lambda_response_bucket.id

  block_public_acls       = true
  block_public_policy     = true
  ignore_public_acls      = true
  restrict_public_buckets = true
}
```

[s3 website overview](https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/learn/lecture/13528322#lecture-article) + [hands on](https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/learn/lecture/34352950#lecture-article)
* blah

[s3 versioning](https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/learn/lecture/13528316#lecture-article) + [hands on](https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/learn/lecture/23743314#lecture-article)
* enabled at the bucket level; null version if file was there before versioning enabled. suspending versioning doesn't delete previous versions
* delete markers - actual previous versions are stil inside bucket, remove market to restore access to file

[replication](https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/learn/lecture/34353002#overview) + [notes](https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/learn/lecture/34353008#lecture-article) + [hands on](https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/learn/lecture/23743374#lecture-article)
* replication - only works if versioning enabled on both source and target. 
* cross region vs same region replication
* iam role required for replication
* no replicaion chaining
* permanent deletions with version IDs are not replicated, delete markers can be optionally replicated
* `S3 Batch Replication` to replicate existing objects
* replication rules

[storage classes overview](https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/learn/lecture/13528350#lecture-article)
* Amazon S3 Standard - General Purpose
* Amazon S3 Infrequent Access (Standard-IA) - Offers 99.9% availability, cost on retrieval
* Amazon S3 One Zone-Infrequent Access (One Zone-IA) - Offers 99.5% availability
* Glacier Instant Retrieval - milisecond retreival
* Glacier Flexible Retrieval - expedited (1-5min), standard (3-5h), bulk (5-12h) is free. 90 days min storage duration
* Glacier Deep Archive - standard (12h) vs bulk (48h), 180 days min storage duration
* Amazon S3 Intelligent-Tiering
* 11 9s durability -  if you store 10 million objects, you can expect to lose only one object every 10,000 years on average; availability depends on the storage class
